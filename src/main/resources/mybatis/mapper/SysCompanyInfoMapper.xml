<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.zerody.user.mapper.SysCompanyInfoMapper" >
  <resultMap id="BaseResultMap" type="com.zerody.user.domain.SysCompanyInfo" >
    <id column="id" property="id" jdbcType="VARCHAR" />
    <result column="bloc_id" property="blocId" jdbcType="VARCHAR" />
    <result column="company_name" property="companyName" jdbcType="VARCHAR" />
    <result column="company_code" property="companyCode" jdbcType="VARCHAR" />
    <result column="company_short_name" property="companyShortName" jdbcType="VARCHAR" />
    <result column="registered_capital" property="registeredCapital" jdbcType="VARCHAR" />
    <result column="enterprise_nature" property="enterpriseNature" jdbcType="VARCHAR" />
    <result column="is_tax_payer" property="isTaxPayer" jdbcType="TINYINT" />
    <result column="company_addr_province_code" property="companyAddrProvinceCode" jdbcType="VARCHAR" />
    <result column="company_address_city_code" property="companyAddressCityCode" jdbcType="VARCHAR" />
    <result column="company_address_area_code" property="companyAddressAreaCode" jdbcType="VARCHAR" />
    <result column="company_address" property="companyAddress" jdbcType="VARCHAR" />
    <result column="enterprise_email" property="enterpriseEmail" jdbcType="VARCHAR" />
    <result column="business_landline_number" property="businessLandlineNumber" jdbcType="VARCHAR" />
    <result column="contact_name" property="contactName" jdbcType="VARCHAR" />
    <result column="contact_phone" property="contactPhone" jdbcType="VARCHAR" />
    <result column="contact_mail" property="contactMail" jdbcType="VARCHAR" />
    <result column="taxpayer_identification_number" property="taxpayerIdentificationNumber" jdbcType="VARCHAR" />
    <result column="business_license_address" property="businessLicenseAddress" jdbcType="VARCHAR" />
    <result column="business_license_code" property="businessLicenseCode" jdbcType="VARCHAR" />
    <result column="business_license_url" property="businessLicenseUrl" jdbcType="VARCHAR" />
    <result column="business_license_valid" property="businessLicenseValid" jdbcType="VARCHAR" />
    <result column="legal_representative" property="legalRepresentative" jdbcType="VARCHAR" />
    <result column="legal_personcert_no" property="legalPersoncertNo" jdbcType="VARCHAR" />
    <result column="company_type" property="companyType" jdbcType="TINYINT" />
    <result column="parent_company_info_id" property="parentCompanyInfoId" jdbcType="VARCHAR" />
    <result column="admin_account" property="adminAccount" jdbcType="VARCHAR" />
    <result column="create_id" property="createId" jdbcType="VARCHAR" />
    <result column="create_user" property="createUser" jdbcType="VARCHAR" />
    <result column="create_time" property="createTime" jdbcType="TIMESTAMP" />
    <result column="update_id" property="updateId" jdbcType="VARCHAR" />
    <result column="update_user" property="updateUser" jdbcType="VARCHAR" />
    <result column="update_time" property="updateTime" jdbcType="TIMESTAMP" />
    <result column="status" property="status" jdbcType="TINYINT" />
    <result column="remark_" property="remark" jdbcType="VARCHAR" />
  </resultMap>
  <resultMap id="ResultMapWithBLOBs" type="com.zerody.user.domain.SysCompanyInfo" extends="BaseResultMap" >
    <result column="company_introduction" property="companyIntroduction" jdbcType="LONGVARCHAR" />
  </resultMap>
  <sql id="Base_Column_List" >
    id, bloc_id, company_name, company_code, company_short_name, registered_capital, 
    enterprise_nature, is_tax_payer, company_addr_province_code, company_address_city_code, 
    company_address_area_code, company_address, enterprise_email, business_landline_number, 
    contact_name, contact_phone, contact_mail, taxpayer_identification_number, business_license_address, 
    business_license_code, business_license_url, business_license_valid, legal_representative, 
    legal_personcert_no, company_type, parent_company_info_id, admin_account, create_id, 
    create_user, create_time, update_id, update_user, update_time, status, remark_
  </sql>
  <sql id="Blob_Column_List" >
    company_introduction
  </sql>
  <select id="getPageCompany" resultType="com.zerody.user.vo.SysComapnyInfoVo">
      SELECT
      id,
      company_name,
      company_code,
      contact_name,
      contact_phone,
      status
      FROM
      sys_company_info
     <where>
        <choose>
            <when test="company.status != null and company.status != -1">
                status = #{company.status}
            </when>
            <otherwise>
                status != -1
            </otherwise>
        </choose>
       <if test="company.companyName != null and company.companyName != ''">
         and company_name like  concat('%',#{company.companyName},'%')
       </if>
     </where>
     order by create_time desc
  </select>
  <select id="getAllCompnay"  resultType="com.zerody.user.vo.SysComapnyInfoVo">
      SELECT
        sci.id,
        sci.company_name,
        sci.company_code,
        sci.company_addr_province_code,
        sci.company_address_city_code,
        sci.company_address_area_code,
        sci.company_address,
        sci.contact_name,
        sci.contact_phone,
        ssi.id adminAccount,
        ssi.user_name AS adminName,
        sci.status
      FROM
            sys_company_info AS sci
      LEFT JOIN  company_admin AS ca ON ca.company_id = sci.id
      LEFT JOIN sys_staff_info AS ssi ON ca.staff_id = ssi.id and ssi.status = 0
      where
        sci.status = 0
  </select>
    <select id="selectCompanyInfoById" resultType="com.zerody.user.vo.SysComapnyInfoVo">
      SELECT
        sci.id,
        sci.company_name,
        sci.company_code,
        sci.company_addr_province_code,
        sci.company_address_city_code,
        sci.company_address_area_code,
        sci.company_address,
        sci.contact_name,
        sci.contact_phone,
        ssi.id adminAccount,
        ssi.user_name AS adminName,
        sci.status
      FROM
            sys_company_info AS sci
      LEFT JOIN  company_admin AS ca ON ca.company_id = sci.id
      LEFT JOIN sys_staff_info AS ssi ON ca.staff_id = ssi.id and ssi.status = 0
      <where>
          sci.id = #{ids}
      </where>

    </select>
    <select id="getCompanyByUserId" resultType="com.zerody.user.vo.SysComapnyInfoVo">
        SELECT
        sci.id,
        sci.company_name
        FROM
        sys_company_info sci
        JOIN sys_staff_info ssi ON sci.id = comp_id
        <where>
            ssi.user_id = #{userId}
        </where>

    </select>
    <select id="getCompanyInfoByAddr" resultType="com.zerody.user.vo.SysComapnyInfoVo">
        SELECT
        sci.id,
        sci.company_name,
        sci.company_code,
        sci.company_addr_province_code,
        sci.company_address_city_code,
        sci.company_address_area_code,
        sci.company_address,
        sci.contact_name,
        sci.contact_phone,
        sci.status
        FROM
        sys_company_info AS sci
        <where>
            sci.company_addr_province_code = #{province}
            and
            sci.company_address_city_code = #{city}
        </where>
    </select>
</mapper>