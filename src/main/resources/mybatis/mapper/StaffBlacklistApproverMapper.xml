<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.zerody.user.mapper.StaffBlacklistApproverMapper">

    <select id="getBlacklistApproverPage" resultType="com.zerody.user.vo.StaffBlacklistApproverVo">
        select
            id,
            userId,
            userName,
            companyId,
            companyName,
            deptId,
            deptName,
            postName,
            mobile,
            identityCard,
            roleId,
            roleName,
            approveTime,
            type,
            submitUserName,
            reason
        from
        staff_blacklist_approver as sba
        <where>
            <if test="param.departId neq null and param.departId neq ''">
                AND (sba.dept_id = #{param.departId} OR sba.dept_id LIKE CONCAT(#{param.departId}, '\_%'))
            </if>
            <if test="param.companyId neq null and param.companyId neq ''">
                AND sba.company_id = #{param.companyId}
            </if>
            <if test="param.companyIds neq null and param.companyIds.size() gt 0">
                and sba.company_id
                <foreach collection="param.companyIds" item="id" open="IN (" separator="," close=")">
                    #{id}
                </foreach>
            </if>
            <if test="param.userName neq null and param.userName neq ''">
                AND sba.userName LIKE CONCAT('%', #{param.userName}, '%')
            </if>
            <if test="param.submitUserName neq null and param.submitUserName neq ''">
                AND sba.submit_user_name LIKE CONCAT('%', #{param.submitUserName}, '%')
            </if>
            <if test="param.mobile neq null and param.mobile neq ''">
                AND sba.mobile LIKE CONCAT('%', #{param.mobile}, '%')
            </if>
            <if test="param.approveState neq null and param.approveState neq ''">
                AND sba.approveState LIKE CONCAT('%', #{param.approveState}, '%')
            </if>
            <if test="param.type neq null">
                AND sba.type = #{param.type}
            </if>
        </where>
        order by approveTime desc
    </select>
</mapper>